# 功能改进

## 已完成 (100% 实现)

1. 下载的时候需要显示进度条，并可以打断（✅已完成）
2. 更容易的部署 and 打开使用（✅已完成打开）
3. 查询时如果没有数据则自动下载（✅已完成）
4. 排查太阳辐射总计是否错误（✅已完成）
5. 顶部增加按钮快速跳转到不同的位置（✅已完成）
6. 增加一个按钮，可以快速选择最近的7天，14天，30天，90天，180天，365天（✅已完成）
7. bug：点击导出excel报错（✅已完成）
8. 如果后端退出，前端有提示（✅已完成）
9. 下载的数据包含城市、汇总数据等信息（✅已完成）
10. 查询时日期可以选择昨天（✅已完成）
11. 改进前端 UI 城市日期选择（✅已完成）
12. 增加打开/关闭后台服务按钮（✅已完成）
13. 一次选择多个城市下载（✅已完成）
14. 日期限制，不能选今天（✅已完成）
15. 默认查询日期为昨天（✅已完成）
16. 修复对比界面显示 undefined 文本的问题（✅已完成）
17. 修复数据管理城市加载提示（✅已完成）
18. 多日查询可切换查看具体某日（✅已完成）
19. 多站查询提供按钮切换查看（✅已完成）
20. 彻底解决后端进程退出问题（✅已完成）
21. 增加 WMO 天气代码翻译显示（✅已完成）
22. 提取公共查询逻辑（✅已完成）
23. 数据管理提供完整字段导出（✅已完成）
24. 启动脚本自动打开浏览器（✅已完成）
25. 前端连接状态灯逻辑（✅已完成）
26. 处理无效/缺失的数据字段（✅已完成）
27. 获取蒸发蒸腾量数据（✅已完成）
28. 字段顺序和格式一致性（✅已完成）
29. 持久化城市默认列表，支持全国搜索添加（✅已完成）
30. 图表上显示对应的城市名称（✅已完成）
31. 增加全部删除按钮（✅已完成）
32. 优化城市排版（✅已完成）
33. 批量下载、选择城市逻辑共用（✅已完成）
34. 太阳辐射的总计换算为Mj/m2（✅已完成）
35. 优化风格为扁平化、苹果风，参考<https://www.apple.com.cn/，背景色是高级的淡灰色（✅已完成）>
36. 风速单位修改为m/s（✅已完成）
37. 删除数据前，可以查看数据大小以及覆盖范围，便于选择删除（✅已完成）
38. 数据管理功能失效了，看不到城市列表，也无法操作（✅已完成）
39. 把不同的功能用选项卡分开（✅已完成）
40. 把那个关闭按钮改成文字「退出」（✅已完成）
41. 批量下载功能异常，点击下载按钮后没反应，按钮变灰色，看不到进度条（✅已完成）
42. 完整性检查报错：检查失败: api.checkCompleteness is not a function（✅2026-01-27 已完成）
43. 将标题字体改为高级感蓝色渐变（✅2026-01-27 已完成）
44. 将查询逻辑改为“全自动本地优先”（✅2026-01-27 已完成）
45. 查看图形曲线时，可以根据鼠标位置查看精确数值（✅2026-01-27 已完成）
46. 取消导出数据汇总表，精简导出流程（✅2026-01-29 12:00 已完成）
47. 每日汇总增加主要天气、日辐照量 (MJ/m²) 和平均风速 (m/s)（✅2026-01-29 12:00 已完成）
48. 完成 Docker 容器化配置文件 (Dockerfile/compose) 以支持 QNAP NAS 部署（✅2026-01-29 12:00 已完成）
49. 更新所有说明文档并标注更新日期（✅2026-01-29 12:00 已完成）
50. 修复导出数据字段不全的问题，增加“字段感应式自动下载”逻辑（✅2026-01-29 13:00 已完成）
51. 下载的数据信息不全（✅2026-01-29 13:10 已完成）
52. 点击「导出选定范围数据到本地」后提示文件准备进度（✅2026年1月29日 13:41 已完成）
53. **QNAP NAS Docker 部署与维护方案**:
    1. **部署**: 已在项目根目录提供 `Dockerfile` 和 `docker-compose.yml`。在 NAS 的 Container Station 中通过 Docker Compose 部署即可。 ✅已完成
    2. **持久化**: 务必将 `/app/data` 挂载到 NAS 共享文件夹，确保数据库文件不会因容器删除而丢失。 ✅已完成

54. 增加网站图标（✅2026-01-31 14:00 已完成）
55. 名字修改为「天气查询系统」（✅2026-01-31 14:10 已完成）
56. 删除点击退出功能（✅2026-01-31 14:17 已完成）
57. 更新网站图标为更美观的 PNG 版本（✅2026-01-31 14:17 已完成）
58. 增加实时天气获取功能（✅2026-01-31 15:15 已完成）
59. 增加预测天气数据获取功能（✅2026-01-31 15:15 已完成）
60. bug，显示数据项选择无效 ✅2026年1月31日 18:43 已完成
61. bug，今日趋势/明日趋势都没有图例，缺少辐照度、风速等关键信息的查看 ✅2026年1月31日 18:43 已完成
62. 样式修改，未来天气预报，每一天的信息，下面用浅灰色阴影标识和区分 ✅2026年1月31日 18:43 已完成
63. bug，点击未来天气预报进入后，缺少辐照度信息 ✅2026年1月31日 18:43 已完成
64. 今日趋势需要精确到每15分钟 ✅2026年1月31日 18:52
65. 在天气预报 & 实况 页面，增加一个刷新按钮 ✅2026年1月31日 18:52
66. 删除「未来一周温度趋势预测」 ✅2026年1月31日 18:52
67. 天气预报&实况的城市用一样的逻辑，采用城市管理来提前筛选好可选的城市 ✅2026年1月31日 18:58
68. 优化UI（✅2026-01-31 22:58 已完成，采用 Apple 极简扁平风格）
69. 调整未来7天预报的日期显示，缩小字体并禁止换行 ✅2026年1月31日 23:37
70. 修复阴天图标显示不正确的问题（原显示为多云） ✅2026年1月31日 23:46
71. 修复实况天气图标不显示的问题（增加显式宽高定义） ✅2026年1月31日 23:55
72. 将「数据查询」改「历史数据查询」 ✅2026年2月1日 00:05
73. 增加彻底关闭服务的脚本 stop.sh/stop.command ✅2026年2月1日 00:05
74. 增强 VPS 部署时的默认城市初始化逻辑 ✅2026年2月1日 00:05
75. 修复因时区偏移（UTC vs Local）导致凌晨访问时“今日趋势”不显示的 Bug ✅2026年2月1日 06:50
76. 修复“今日趋势”在 15min 数据缺失时不显示的问题（增加小时数据回退逻辑） ✅2026年2月1日 09:30
77. 增加网页动态时间显示 ✅2026年2月1日 09:30
78. 「天气预报&实况」点击「今日趋势」图形展开后显示画面太大，没看到导出按钮和放大的曲线图，点击「明日展望」图形展开后，看到导出按钮，数据不能上下滚动，但是点击「导出数据」按钮无效 ✅2026年2月1日 09:26
79. 风速单位为m/s ✅2026年2月1日 09:26
80. 点击「今日趋势」、「明日展望」，可以弹窗放大显示，并列表展示数据，同时具备导出功能 ✅2026年2月1日 09:29
81. 「历史数据查询」和「天气预报&实况」的城市选择逻辑合成并做成一致的，做一个切换按钮，可以切换为按单城市查看和多城市比对查看的方式。现在历史数据查询这里做得还可以。 ✅2026年2月1日 09:41
82. 「数据图层控制」默认勾选「风速」和「太阳辐射」，「气温」和「降水概率」不选 ✅2026年2月1日 09:42
83. 「天气预报&实况」的城市列表多选无效，且与「历史天气数据」排版不一致，需要UI统一按「历史数据查询」样式统一UI排版 ✅2026年2月1日 13:25
84. 记录网站访问日志，记录访问ip，机器名，访问日志，也放到「数据管理」 ✅2026年2月1日 14:09
85. 增加：在数据管理-城市管理，增加输入坐标定义位置功能，设置坐标，对该坐标设置名称（比如查询不到的县城或地点），查询并加入该坐标的天气数据 ✅2026年2月1日 14:09
86. 记录系统告警日志，增加 API 频率限制功能，支持后台设置频率上限 ✅2026年2月1日 15:45
87. 增加版本显示，用日期命名 ✅2026年2月1日 15:45
88. 历史数据查询，南宁查询看不到昨日的数据曲线，但是可以看到前天的，精度还是1个小时，请确认api的数据是否只有1个小时的，有15分钟的 ✅2026年2月3日 17:17
89. 时间可能计算错误，滞后了1个小时，请核对。已修正 ✅2026年2月3日 17:17
90. 把数据复盘功能放到顶部，叫「历史数据复盘」 ✅2026年2月3日 17:18
91. 增加版本号显示，版本号用日期时间 ✅2026年2月3日 18:28
92. 修复 `./start.command` 启动脚本在 macOS 下因 SSL 证书问题导致无法安装依赖的问题，以及因路径变更导致的虚拟环境失效问题。改为使用阿里云镜像源并优化虚拟环境调用。（✅2026-02-03 20:06 已完成）
93. UI优化：优化城市选择框样式，背景改为浅灰色 (#f3f4f6) 以区分输入区域；修复城市选择下拉框被下方天气卡片遮挡的问题 (z-index: 9999)。 （✅2026-02-03 20:13 已完成）
94. 修复实况天气加载可能无限挂起的问题（增加15秒超时机制）（✅2026-02-03 20:45 已完成）
95. 重构「天气预报&实况」→「天气预测查询」：删除旧的实况看板页面，参考「历史数据查询」重新设计为统一风格的预测查询页面（✅2026-02-03 21:15 已完成）
    - 新增后端 API `/api/weather/forecast-query`：返回15分钟精度数据+7天预报+统计摘要
    - 前端页面包含：城市选择、预测天数选择、数据字段选择、统计卡片、7天预报概览、温度/辐照度/风速/降水图表、详细数据表格
    - 支持CSV导出
96. 优化「天气预测查询」UI并整合实时数据（✅2026-02-03 22:15 已完成）
    - 修复统计卡片字段名不匹配导致的数值显示为 `--` 的问题
    - 修复统计卡片布局错乱，特别是第6个卡片换行的问题
    - 在预测结果顶部增加「实时天气实况」展示位，实现预测与实况的同屏展示
    - 移除不再需要的「历史数据复盘」标签页及其相关逻辑
    - 优化页面滚动定位逻辑，修复顶部固定导航栏遮挡查询结果的问题

97. ✅ **彻底移除「历史预测回看」功能 (2026-02-04)**：
    - 移除前端 `index.html` 中的「历史预测回看」UI 模块
    - 清理 `data-management.js` 和 `api.js` 中所有关于存档、回看的逻辑
    - 移除后端相关的 API 接口及数据库表结构，保持系统简洁

98. ✅ **天气预测查询体验升级 (2026-02-03)**：
    - 支持多城市分组展示，按城市显示统计汇总（参考图片样式）。
    - 统计卡片：移除冗余字段（查询城市/数据点/预测范围），保留核心指标并优化数值格式。
    - 预测范围统一移动至数据区顶部全局显示。
    - 实时天气 UI 进化：采用图标化网格设计，整合城市名称、坐标与更新时间。
    - 曲线图表重构：新增 24 小时高精度预测趋势图，支持按字段选择展示曲线（默认辐照度/风速）。
    - 修复图表下滑显示问题，优化页面滚动逻辑。

## 待处理

无

## 后续改进

看看有没有更好的方案，改进UI，在保持原有全部功能的情况下，做成同时支持pc端和移动端访问，保留显示风格
能否获取气象灾害预警数据
能否将预报数据与实际数据比对分析
