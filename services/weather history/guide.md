# 天气查询系统 - 使用说明文档 (Guide)

更新日期：2026-02-01

## 1. 快速入门

### 1.1 本地启动 (macOS)

1. 在项目根目录下，直接双击运行 `start.command`。
2. 脚本会自动初始化环境并启动服务。
3. 浏览器会自动打开 `http://localhost:5001`。

### 1.2 远程部署

* **NAS 部署**: 使用 `docker-compose up -d --build` 或 `./sync_to_nas.sh`。
* **VPS 部署**: 使用 `./deploy_to_vps.sh` 脚本。
* **关闭服务**: 在项目根目录下运行 `./stop.sh` (Linux/VPS) 或双击 `stop.command` (macOS)。

## 2. 功能详细说明

### 2.1 天气预测查询

* **预测视图**: 查看单个城市的未来 7~14 天预报及 15 分钟级高精度趋势图。
* **实时实况**: 在查询预测的同时，自动获取并展示该城市的当前实时天气状态（温度、风速、各维度辐照度）。
* **数据统计**: 自动计算预测周期内的平均温度、最大风速、累计辐照量等关键指标。
* **数据导出**: 支持将 15 分钟精度的预测数据导出为 CSV/Excel，便于离线分析。

### 2.2 历史查询

* **全自动下载**: 如果本地数据库没有您请求的日期数据，系统会自动从 Open-Meteo API 下载并补全。
* **多维度数据**: 支持查看温度、降水、风速、各维度辐照度及蒸发蒸腾量。

### 2.3 数据管理

* **城市管理**:
  * 搜索添加：支持搜索全国省市县并加入列表。
  * **坐标定义**: 支持手动输入经纬度坐标并自定义名称（适用于无气象站的偏远地区查询）。
* **访问日志**: 记录每次 API 请求的 IP、**机器名 (Hostname)**、路径及响应时长。
* **系统告警**: 记录系统运行中的警告、错误及 **API 频率限制** 触发情况。
* **系统设置**: 支持在后台动态设置 API 访问频率限制（次/分钟）。

## 3. 部署与维护

### 3.1 Docker 部署

项目支持容器化，默认映射端口为 `5002` (主机) -> `5001` (容器)。

### 3.2 配置文件

* 后端主配置位于 `backend/config.py`。
* Docker 配置位于 `Dockerfile` 和 `docker-compose.yml`。

## 4. 常见问题 (FAQ)

**Q: 多城市比对时有些城市加载不出数据？**
A: 请检查网络连接或是否触发了 API 频率限制。如果失败，可以点击卡片上的“重试”按钮。

**Q: 如何修改 API 访问上限？**
A: 在“数据管理” -> “系统告警”标签页中，可以修改“API 频率限制”并点击保存。

**Q: 数据库路径在哪里？**
A: 默认位于 `data/weather.db`。NAS 部署时务必挂载此路径以持久化数据。
