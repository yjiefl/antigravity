<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025å¹´å—æ–¹åŒºåŸŸæ–°èƒ½æºåœºç«™Eæ–‡ä»¶æ•°æ®åˆæ ¼ç‡æ™ºèƒ½åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f0f4f8; /* Light gray-blue background */
            color: #1e293b;
        }

        /* Chart Container Styling - Mandatory Requirement */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Constrain max width */
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Custom Utilities */
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        
        .tab-inactive {
            color: #64748b;
        }
        
        .tab-inactive:hover {
            color: #334155;
        }

        /* Range Input Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -6px; 
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }
    </style>
    <!-- Chosen Palette: "Data Guardian" - Slate (Neutral), Blue (Primary), Emerald (Safe), Rose (Danger), Amber (Warning) -->
    <!-- Application Structure Plan: 
         1. Header: Clear title and purpose.
         2. "The Golden Rules" (Dashboard): An interactive score calculator to demonstrate the penalty logic (Late vs. Quality).
         3. "Indicator Inspector" (Main Content): A tabbed interface dividing rules by file type (Wind, PV, Meteo, Stats). Each tab contains interactive cards for specific indicators.
         4. "Diagnostic Toolkit": Interactive calculators for complex rules (Irradiance Consistency, Wind Shear) to allow operators to input real data and test compliance immediately.
         5. "Alert & Response": A troubleshooting guide mapping common alarms to specific actions.
         Why: This structure moves from high-level impact (Money/Score) to specific rules (How to calc) to action (What to do), mirroring the user's cognitive flow during O&M.
    -->
    <!-- Visualization & Content Choices:
         1. Scoring Impact: Doughnut Chart (Chart.js) -> Shows the weight of penalties. Goal: Inform/Motivate.
         2. Indicator Logic: Cards with Status Badges. Goal: Organize. No SVG.
         3. Dead Value Sim: Line Chart (Chart.js) -> Visualizes what a "Dead Value" looks like vs normal data. Goal: Change/Teach.
         4. Calculators: Input fields + Auto-calculation. Goal: Interact/Verify.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 min-h-screen">

    <!-- Navbar -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center gap-2">
                        <span class="text-2xl">âš¡</span>
                        <span class="font-bold text-xl text-slate-800 tracking-tight">Eæ–‡ä»¶æ•°æ®è¿ç»´åŠ©æ‰‹</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-slate-500 hidden md:block">ä¾æ®ï¼š2025å¹´å—æ–¹åŒºåŸŸæŒ‡å¼•</span>
                    <button onclick="scrollToSection('diagnostic')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                        æ•…éšœè¯Šæ–­
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">

        <!-- SECTION 1: Scoring Rules & Impact -->
        <section id="scoring-rules" class="space-y-6">
            <div class="text-center max-w-3xl mx-auto">
                <h2 class="text-3xl font-bold text-slate-900">æ ¸å¿ƒè¯„åˆ†æœºåˆ¶</h2>
                <p class="mt-4 text-lg text-slate-600 leading-relaxed">
                    åˆæ ¼ç‡æ˜¯è€ƒæ ¸çš„æ ¸å¿ƒã€‚ç†è§£â€œæ‰£åˆ†é˜¶æ¢¯â€æ˜¯é¿å…ä½åˆ†çš„å…³é”®ã€‚ä¸‹æ–¹æ¨¡æ‹Ÿå™¨å±•ç¤ºäº†ä¸åŒç±»å‹çš„æ•°æ®é—®é¢˜å¯¹æœ€ç»ˆå¾—åˆ†çš„æ¯ç­æ€§æ‰“å‡»ã€‚
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                <!-- Interactive Simulator -->
                <div class="bg-white rounded-xl card-shadow p-6 border border-slate-100">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-bold text-slate-800">åˆæ ¼ç‡æ¨¡æ‹Ÿå™¨</h3>
                        <span class="px-3 py-1 bg-blue-50 text-blue-700 text-xs font-semibold rounded-full">æ¯æ—¥96ç‚¹/é¡¹</span>
                    </div>
                    
                    <div class="flex flex-col md:flex-row gap-8">
                        <div class="w-full md:w-1/2 flex flex-col justify-center">
                            <div class="chart-container">
                                <canvas id="scoreChart"></canvas>
                            </div>
                            <div class="text-center mt-4">
                                <span class="text-sm text-slate-500">é¢„è®¡å¾—åˆ†</span>
                                <div id="finalScoreDisplay" class="text-4xl font-extrabold text-emerald-600">100%</div>
                            </div>
                        </div>
                        
                        <div class="w-full md:w-1/2 space-y-6">
                            <!-- Sliders -->
                            <div>
                                <label class="flex justify-between text-sm font-medium text-slate-700 mb-1">
                                    <span>æ­£å¸¸ç‚¹æ•° (æ»¡åˆ†)</span>
                                    <span id="val-normal">96</span>
                                </label>
                                <input type="range" id="input-normal" min="0" max="96" value="96" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" disabled>
                            </div>

                            <div>
                                <label class="flex justify-between text-sm font-medium text-amber-700 mb-1">
                                    <span>å»¶è¿Ÿ > 4å°æ—¶ (å¾—åˆ† x 0.5)</span>
                                    <span id="val-late4">0</span>
                                </label>
                                <input type="range" id="input-late4" min="0" max="96" value="0" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-amber-500" oninput="updateScoreSim()">
                                <p class="text-xs text-slate-400 mt-1">æƒé‡ï¼š50%</p>
                            </div>

                            <div>
                                <label class="flex justify-between text-sm font-medium text-rose-700 mb-1">
                                    <span>è´¨é‡ä¸è¾¾æ ‡ (å¾—åˆ† x 0.5)</span>
                                    <span id="val-bad">0</span>
                                </label>
                                <input type="range" id="input-bad" min="0" max="96" value="0" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-rose-500" oninput="updateScoreSim()">
                                <p class="text-xs text-slate-400 mt-1">æƒé‡ï¼š50% (æ ¡éªŒå¤±è´¥)</p>
                            </div>

                            <div>
                                <label class="flex justify-between text-sm font-medium text-slate-900 mb-1">
                                    <span>å»¶è¿Ÿ > 24å°æ—¶ / ç¼ºæ•° (0åˆ†)</span>
                                    <span id="val-miss">0</span>
                                </label>
                                <input type="range" id="input-miss" min="0" max="96" value="0" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-800" oninput="updateScoreSim()">
                                <p class="text-xs text-slate-400 mt-1">æƒé‡ï¼š0%</p>
                            </div>
                            
                            <div class="bg-blue-50 p-3 rounded text-sm text-blue-800">
                                ğŸ’¡ <strong>æç¤ºï¼š</strong> å»¶è¿Ÿè¶…è¿‡4å°æ—¶ä¸ä»…å½±å“æ—¶æ•ˆåˆ†ï¼Œä¹Ÿä¼šç›´æ¥å¯¼è‡´è¯¥ç‚¹å¾—åˆ†å‡åŠã€‚
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rule Summary Cards -->
                <div class="grid grid-cols-1 gap-4">
                    <div class="bg-white p-5 rounded-lg border-l-4 border-rose-500 shadow-sm">
                        <h4 class="font-bold text-rose-700 mb-1">çº¢çº¿ä¸€ï¼šä¸ŠæŠ¥æ—¶æ•ˆ</h4>
                        <p class="text-sm text-slate-600">æ¯15åˆ†é’Ÿä¸ŠæŠ¥ä¸€æ¬¡ã€‚å»¶è¿Ÿè¶…è¿‡ <span class="font-bold">4å°æ—¶</span>ï¼Œå¾—åˆ†å‡åŠï¼›è¶…è¿‡ <span class="font-bold">24å°æ—¶</span>ï¼Œä¸å¾—åˆ†ã€‚</p>
                    </div>
                    <div class="bg-white p-5 rounded-lg border-l-4 border-amber-500 shadow-sm">
                        <h4 class="font-bold text-amber-700 mb-1">çº¢çº¿äºŒï¼šæ•°æ®è´¨é‡</h4>
                        <p class="text-sm text-slate-600">æ•°æ®è™½ç„¶é€è¾¾ï¼Œä½†è‹¥è§¦å‘â€œæ­»æ•°â€ã€â€œè¶Šé™â€æˆ–â€œé€»è¾‘çŸ›ç›¾â€æ ¡éªŒï¼Œè¯¥ç‚¹å¾—åˆ†ç›´æ¥ <span class="font-bold">å‡åŠ</span>ã€‚</p>
                    </div>
                    <div class="bg-white p-5 rounded-lg border-l-4 border-indigo-500 shadow-sm">
                        <h4 class="font-bold text-indigo-700 mb-1">çº¢çº¿ä¸‰ï¼šä¸€è‡´æ€§</h4>
                        <p class="text-sm text-slate-600">æ°”è±¡ã€å•æœºã€ç»Ÿè®¡æ–‡ä»¶ä¹‹é—´çš„æ•°æ®å¿…é¡»é€»è¾‘é—­ç¯ã€‚ä¾‹å¦‚ï¼šå•æœºç´¯åŠ å€¼ä¸å…¨ç«™ç»Ÿè®¡å€¼è¯¯å·®éœ€ <span class="font-bold">â‰¤10%</span>ã€‚</p>
                    </div>
                    
                    <!-- Dead Value Viz -->
                    <div class="bg-white p-4 rounded-lg shadow-sm mt-2">
                        <h4 class="font-bold text-slate-700 mb-2 text-sm">ä»€ä¹ˆæ˜¯â€œæ­»æ•°â€ï¼Ÿ(1å°æ—¶è¿ç»­4ç‚¹ç›¸ç­‰)</h4>
                        <div class="chart-container" style="height: 150px; max-height: 150px;">
                            <canvas id="deadValueChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: Indicator Inspector -->
        <section id="indicators" class="scroll-mt-20">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-slate-900">æŒ‡æ ‡æ ¡éªŒç™¾ç§‘</h2>
                <p class="mt-2 text-slate-600">
                    æŒ‰æ–‡ä»¶ç±»å‹åˆ†ç±»æ•´ç†çš„è¯¦ç»†æ ¡éªŒè§„åˆ™ã€‚ç‚¹å‡»é€‰é¡¹å¡åˆ‡æ¢ï¼Œä½¿ç”¨å³ä¾§å·¥å…·æµ‹è¯•æ‚¨çš„æ•°æ®ã€‚
                </p>
            </div>

            <!-- Tabs -->
            <div class="border-b border-slate-200 mb-6 flex overflow-x-auto space-x-8">
                <button onclick="switchTab('single')" id="tab-single" class="tab-active py-4 px-1 text-sm font-medium whitespace-nowrap">å•æœºä¿¡æ¯ (é£/å…‰)</button>
                <button onclick="switchTab('meteo')" id="tab-meteo" class="tab-inactive py-4 px-1 text-sm font-medium whitespace-nowrap">æ°”è±¡ç¯å¢ƒ (æœ€æ˜“æ‰£åˆ†)</button>
                <button onclick="switchTab('stat')" id="tab-stat" class="tab-inactive py-4 px-1 text-sm font-medium whitespace-nowrap">ç»Ÿè®¡ä¿¡æ¯</button>
                <button onclick="switchTab('predict')" id="tab-predict" class="tab-inactive py-4 px-1 text-sm font-medium whitespace-nowrap">åŠŸç‡é¢„æµ‹</button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left: Rules Grid -->
                <div class="lg:col-span-2 space-y-6" id="rules-container">
                    <!-- Dynamic Content Loaded Here -->
                </div>

                <!-- Right: Interactive Tools Contextual to Tab -->
                <div class="lg:col-span-1">
                    <div id="tool-panel" class="bg-slate-800 text-white rounded-xl p-6 sticky top-24 shadow-lg">
                        <!-- Dynamic Tool Loaded Here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Diagnostic Logic -->
        <section id="diagnostic" class="bg-white rounded-2xl p-8 shadow-sm border border-slate-200">
            <div class="mb-8 border-b border-slate-100 pb-4">
                <h2 class="text-2xl font-bold text-slate-900">å¼‚å¸¸é—®é¢˜å¤„ç†æŒ‡å¼•</h2>
                <p class="text-slate-500 mt-1">å‘ç°å‘Šè­¦åï¼Œè¯·æŒ‰ä»¥ä¸‹æµç¨‹è¿›è¡Œæ’æŸ¥ä¸å¤„ç†ã€‚</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Problem 1 -->
                <div class="group relative bg-slate-50 rounded-lg p-6 hover:bg-rose-50 transition-colors border border-transparent hover:border-rose-100">
                    <div class="absolute top-0 right-0 -mt-2 -mr-2 bg-rose-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold shadow-sm">1</div>
                    <h3 class="text-lg font-bold text-slate-800 mb-2 group-hover:text-rose-700">æ­»æ•°å‘Šè­¦</h3>
                    <p class="text-xs font-mono bg-slate-200 inline-block px-2 py-1 rounded text-slate-600 mb-3">è¿ç»­4ç‚¹æ•°å€¼ç›¸ç­‰</p>
                    <ul class="text-sm text-slate-600 space-y-2 list-disc list-inside">
                        <li>æ£€æŸ¥ä¼ æ„Ÿå™¨æ˜¯å¦ç»“å†°æˆ–å¡æ¶©ï¼ˆç‰¹åˆ«æ˜¯é£é€Ÿä»ªï¼‰ã€‚</li>
                        <li>æ£€æŸ¥é€šè®¯ç®¡ç†æœºæ˜¯å¦â€œå‡æ­»â€æˆ–æ•°æ®å†»ç»“ã€‚</li>
                        <li><strong>å¤„ç†ï¼š</strong>é‡å¯é‡‡é›†è®¾å¤‡æˆ–ç”³è¯·æ ‡è®°æ•…éšœã€‚</li>
                    </ul>
                </div>

                <!-- Problem 2 -->
                <div class="group relative bg-slate-50 rounded-lg p-6 hover:bg-amber-50 transition-colors border border-transparent hover:border-amber-100">
                    <div class="absolute top-0 right-0 -mt-2 -mr-2 bg-amber-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold shadow-sm">2</div>
                    <h3 class="text-lg font-bold text-slate-800 mb-2 group-hover:text-amber-700">è¾å°„/é£é€Ÿé€»è¾‘é”™è¯¯</h3>
                    <p class="text-xs font-mono bg-slate-200 inline-block px-2 py-1 rounded text-slate-600 mb-3">å±‚çº§åå·® / è¾å°„åˆ†é‡ä¸å¹³</p>
                    <ul class="text-sm text-slate-600 space-y-2 list-disc list-inside">
                        <li>æ ¸å¯¹æ€»è¾å°„è¡¨æ˜¯å¦è¢«é®æŒ¡æˆ–æ±¡æŸã€‚</li>
                        <li>æ£€æŸ¥ä¸åŒé«˜åº¦æµ‹é£å¡”ä¼ æ„Ÿå™¨è¯»æ•°æ˜¯å¦å€’ç½®ã€‚</li>
                        <li><strong>å¤„ç†ï¼š</strong>æ¸…æ´—è¡¨å¤´ï¼Œæ ¡å‡†å‚æ•°ï¼Œæ£€æŸ¥åå°å…¬å¼ã€‚</li>
                    </ul>
                </div>

                <!-- Problem 3 -->
                <div class="group relative bg-slate-50 rounded-lg p-6 hover:bg-indigo-50 transition-colors border border-transparent hover:border-indigo-100">
                    <div class="absolute top-0 right-0 -mt-2 -mr-2 bg-indigo-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold shadow-sm">3</div>
                    <h3 class="text-lg font-bold text-slate-800 mb-2 group-hover:text-indigo-700">å…¨ç«™åŠŸç‡ä¸åŒ¹é…</h3>
                    <p class="text-xs font-mono bg-slate-200 inline-block px-2 py-1 rounded text-slate-600 mb-3">å…¨ç«™ â‰  âˆ‘å•æœº (è¯¯å·®>10%)</p>
                    <ul class="text-sm text-slate-600 space-y-2 list-disc list-inside">
                        <li>æ£€æŸ¥æ˜¯å¦æœ‰å•æœºé€šè®¯ä¸­æ–­ï¼ˆæ‰çº¿ï¼‰ã€‚</li>
                        <li>æ ¸å¯¹å‡å‹ç«™å…³å£è¡¨æ•°æ®é‡‡é›†æ—¶é—´æ˜¯å¦ä¸å•æœºåŒæ­¥ã€‚</li>
                        <li><strong>å¤„ç†ï¼š</strong>æ’æŸ¥æ‰çº¿è®¾å¤‡ï¼Œæ£€æŸ¥å…¨ç«™ç»Ÿè®¡è„šæœ¬ã€‚</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center text-slate-400 text-sm pb-8">
            <p>åŸºäºã€Š2025å¹´å—æ–¹åŒºåŸŸæ–°èƒ½æºåœºç«™Eæ–‡ä»¶æ•°æ®åˆæ ¼ç‡ç»Ÿè®¡æŒ‡å¼•ã€‹ç”Ÿæˆ</p>
        </footer>

    </main>

    <script>
        // --- DATA STORE ---
        // Storing the rules as structured data
        const ruleData = {
            single: [
                {
                    title: "æœ‰åŠŸåŠŸç‡ (Active Power)",
                    range: "[-0.1 Ã— é¢å®š, é¢å®šå®¹é‡]",
                    deadRule: "1å°æ—¶å†…æœ€å¤§å€¼=æœ€å°å€¼ (ä¸”>0) åˆ¤ä¸ºæ­»æ•°",
                    consistency: "å¾…æœº/åœè¿æ—¶ï¼Œæœ‰åŠŸé¡»åœ¨ [-0.1Ã—é¢å®š, 0] ä¹‹é—´ã€‚",
                    highlight: false
                },
                {
                    title: "çŠ¶æ€ä¸€è‡´æ€§ (Status)",
                    range: "N/A",
                    deadRule: "N/A",
                    consistency: "æœºç»„çŠ¶æ€ï¼ˆè¿è¡Œ/å¾…æœº/æ•…éšœï¼‰å¿…é¡»ä¸æœ‰åŠŸåŠŸç‡ç‰©ç†å¯¹åº”ã€‚æ•…éšœæ—¶åŠŸç‡é€šå¸¸ä¸º0æˆ–è´Ÿã€‚",
                    highlight: true
                },
                {
                    title: "å…‰ä¼é€†å˜å™¨/ç®±å˜æœ‰åŠŸ",
                    range: "08:00-18:00 éæ•…éšœæ€ â‰¥ 0",
                    deadRule: "è¿ç»­4ç‚¹æ•°å€¼ç›¸ç­‰",
                    consistency: "å¤œé—´æ•°æ®é€šå¸¸ä¸å‚ä¸æ ¡éªŒï¼Œé‡ç‚¹å…³æ³¨ç™½é—´é€šè®¯ã€‚",
                    highlight: false
                }
            ],
            meteo: [
                {
                    title: "é£é€Ÿ (Wind Speed)",
                    range: "[0, 55] m/s",
                    deadRule: "è¿ç»­4ç‚¹ç›¸ç­‰ï¼›æˆ–6hæ»‘åŠ¨å‡å€¼å˜åŒ– < 0.3",
                    consistency: "å±‚çº§æ ¡éªŒï¼š|V1 - V2| â‰¥ 4 Ã— å±‚çº§å·®ï¼Œåˆ¤å®šä¸åˆç†ã€‚",
                    highlight: true
                },
                {
                    title: "æ€»è¾å°„ (Total Irradiance)",
                    range: "[0, 1500] W/mÂ²",
                    deadRule: "è¿ç»­4ç‚¹ç›¸ç­‰ï¼›ä¸1hå‡å€¼åå·® > 800",
                    consistency: "å…¬å¼ï¼š|(ç›´å°„+æ•£å°„ - æ€») / æ€»| â‰¤ 5%ã€‚(æ€»è¾å°„<50æ—¶åˆ†æ¯å–50)",
                    highlight: true
                },
                {
                    title: "ç¯å¢ƒæ¸©åº¦ (Temperature)",
                    range: "[-20, 60] â„ƒ",
                    deadRule: "2hå†…æœ€å¤§å€¼ä¸æœ€å°å€¼å·®å¿…é¡» > 0",
                    consistency: "æ— ç‰¹å®šå±‚çº§æ ¡éªŒï¼Œå…³æ³¨æ­»æ•°ã€‚",
                    highlight: false
                }
            ],
            stat: [
                {
                    title: "å…¨ç«™æœ‰åŠŸ (Station Power)",
                    range: "[-0.1Ã—è£…æœº, 1.1Ã—è£…æœº]",
                    deadRule: "N/A",
                    consistency: "å¿…é¡»ä¸â€œå„å•æœºæœ‰åŠŸä¹‹å’Œâ€åå·® â‰¤ 10%ã€‚",
                    highlight: true
                },
                {
                    title: "å…¨ç«™å¯ç”¨æœ‰åŠŸ",
                    range: "[-0.1Ã—è£…æœº, 1.1Ã—è£…æœº]",
                    deadRule: "N/A",
                    consistency: "éœ€æ»¡è¶³é™„ä»¶3é€»è¾‘ã€‚é™ç”µæ—¶ï¼Œç†è®º > å¯ç”¨ > å®å‘ã€‚",
                    highlight: false
                }
            ],
            predict: [
                {
                    title: "è¶…çŸ­æœŸé¢„æµ‹",
                    range: "[0, è£…æœºå®¹é‡]",
                    deadRule: "N/A",
                    consistency: "ä¸ŠæŠ¥æ—¶é—´å¿…é¡»æ—©äºè€ƒæ ¸ç‚¹ã€‚éé™ç”µæ—¶å‡†ç¡®ç‡éœ€è¾¾æ ‡ã€‚",
                    highlight: true
                }
            ]
        };

        const toolsHTML = {
            single: `
                <h3 class="text-lg font-bold text-white mb-4">ğŸ”§ å•æœºåŠŸç‡æ ¡éªŒ</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">é¢å®šå®¹é‡ (MW)</label>
                        <input type="number" id="calc-cap" class="w-full bg-slate-700 border-none rounded px-3 py-2 text-white" placeholder="2.5">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">å½“å‰æœ‰åŠŸ (MW)</label>
                        <input type="number" id="calc-power" class="w-full bg-slate-700 border-none rounded px-3 py-2 text-white" placeholder="2.6">
                    </div>
                    <button onclick="checkPower()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded font-medium transition">ä¸€é”®æ ¡éªŒ</button>
                    <div id="res-power" class="hidden mt-4 p-3 bg-slate-900 rounded border border-slate-600 text-sm"></div>
                </div>
            `,
            meteo: `
                <h3 class="text-lg font-bold text-white mb-4">â˜€ï¸ è¾å°„å¹³è¡¡è®¡ç®—å™¨</h3>
                <p class="text-xs text-slate-400 mb-3">æ ¡éªŒå…¬å¼ï¼š|(ç›´+æ•£ - æ€»)/æ€»| â‰¤ 5%</p>
                <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="block text-xs text-slate-400">æ€»è¾å°„</label>
                            <input type="number" id="rad-total" class="w-full bg-slate-700 rounded px-2 py-1 text-white" placeholder="800">
                        </div>
                        <div>
                            <label class="block text-xs text-slate-400">ç›´å°„</label>
                            <input type="number" id="rad-direct" class="w-full bg-slate-700 rounded px-2 py-1 text-white" placeholder="400">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400">æ•£å°„</label>
                        <input type="number" id="rad-scatter" class="w-full bg-slate-700 rounded px-2 py-1 text-white" placeholder="300">
                    </div>
                    <button onclick="checkRadiation()" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white py-2 rounded font-medium transition">è®¡ç®—åå·®ç‡</button>
                    <div id="res-rad" class="hidden mt-4 p-3 bg-slate-900 rounded border border-slate-600 text-sm"></div>
                </div>
            `,
            stat: `
                <h3 class="text-lg font-bold text-white mb-4">ğŸ“Š å…¨ç«™æ±‡æ€»æ ¡éªŒ</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">å…¨ç«™è¡¨è®¡æœ‰åŠŸ</label>
                        <input type="number" id="stat-total" class="w-full bg-slate-700 border-none rounded px-3 py-2 text-white" placeholder="100">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">å•æœºæœ‰åŠŸç´¯åŠ å€¼</label>
                        <input type="number" id="stat-sum" class="w-full bg-slate-700 border-none rounded px-3 py-2 text-white" placeholder="88">
                    </div>
                    <button onclick="checkStat()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded font-medium transition">æ ¡éªŒè¯¯å·® (â‰¤10%)</button>
                    <div id="res-stat" class="hidden mt-4 p-3 bg-slate-900 rounded border border-slate-600 text-sm"></div>
                </div>
            `,
            predict: `
                <h3 class="text-lg font-bold text-white mb-4">â±ï¸ é¢„æµ‹æ—¶æ•ˆæ£€æŸ¥</h3>
                <div class="p-3 bg-slate-700 rounded text-xs text-slate-300">
                    æ­¤å¤„åº”è¿æ¥åå°ä¸Šé€æ—¥å¿—ã€‚è¯·ç¡®ä¿åœ¨æ¯15åˆ†é’ŸèŠ‚ç‚¹å‰å®Œæˆæ–‡ä»¶ç”Ÿæˆä¸è½¬å‘ã€‚
                    <br><br>
                    <strong>çº¢çº¿ï¼š</strong> è¶…è¿‡4å°æ—¶æœªæ›´æ–°ï¼Œè€ƒæ ¸åˆ†å‡åŠã€‚
                </div>
            `
        };

        // --- CHART JS INITIALIZATION ---
        let scoreChartInstance = null;
        let deadValueChartInstance = null;

        function initCharts() {
            // 1. Score Simulator Chart (Doughnut)
            const ctxScore = document.getElementById('scoreChart').getContext('2d');
            scoreChartInstance = new Chart(ctxScore, {
                type: 'doughnut',
                data: {
                    labels: ['æœ‰æ•ˆå¾—åˆ†', 'æŸå¤±åˆ†æ•°'],
                    datasets: [{
                        data: [100, 0],
                        backgroundColor: ['#10b981', '#cbd5e1'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });

            // 2. Dead Value Visualization (Line)
            const ctxDead = document.getElementById('deadValueChart').getContext('2d');
            deadValueChartInstance = new Chart(ctxDead, {
                type: 'line',
                data: {
                    labels: ['10:00', '10:15', '10:30', '10:45', '11:00', '11:15', '11:30', '11:45'],
                    datasets: [
                        {
                            label: 'æ­£å¸¸æ³¢åŠ¨',
                            data: [12, 14, 13, 15, 16, 14, 18, 17],
                            borderColor: '#10b981',
                            tension: 0.4,
                            pointRadius: 2
                        },
                        {
                            label: 'æ­»æ•° (è¿ç»­4ç‚¹ç›¸ç­‰)',
                            data: [5, 8, 8, 8, 8, 5, 6, 7],
                            borderColor: '#f43f5e',
                            borderDash: [5, 5],
                            pointBackgroundColor: ['transparent', '#f43f5e', '#f43f5e', '#f43f5e', '#f43f5e', 'transparent', 'transparent', 'transparent'],
                            pointRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 } } }
                    },
                    scales: {
                        y: { display: false },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // --- LOGIC FUNCTIONS ---

        function updateScoreSim() {
            const totalPoints = 96;
            const late4 = parseInt(document.getElementById('input-late4').value);
            const bad = parseInt(document.getElementById('input-bad').value);
            const miss = parseInt(document.getElementById('input-miss').value);
            
            // Limit logic: sum cannot exceed 96.
            // Simple approach: reduce 'normal' to fit
            let used = late4 + bad + miss;
            if (used > totalPoints) {
                // primitive clamping for UX
                used = totalPoints; 
                // In a real app, we'd adjust the sliders being dragged.
            }
            
            const normal = totalPoints - used;
            document.getElementById('input-normal').value = normal;
            document.getElementById('val-normal').innerText = normal;
            document.getElementById('val-late4').innerText = late4;
            document.getElementById('val-bad').innerText = bad;
            document.getElementById('val-miss').innerText = miss;

            // Calc Score
            // Normal = 1 pt per point (normalized)
            // Late4 = 0.5 pt
            // Bad = 0.5 pt
            // Miss = 0 pt
            
            const currentScore = (normal * 1) + (late4 * 0.5) + (bad * 0.5) + (miss * 0);
            const maxScore = totalPoints * 1;
            const percentage = ((currentScore / maxScore) * 100).toFixed(1);

            // Update DOM
            const display = document.getElementById('finalScoreDisplay');
            display.innerText = percentage + '%';
            
            if (percentage < 60) display.classList.replace('text-emerald-600', 'text-rose-600');
            else if (percentage < 90) {
                display.classList.remove('text-emerald-600', 'text-rose-600');
                display.classList.add('text-amber-500');
            } else {
                display.classList.remove('text-rose-600', 'text-amber-500');
                display.classList.add('text-emerald-600');
            }

            // Update Chart
            scoreChartInstance.data.datasets[0].data = [currentScore, maxScore - currentScore];
            scoreChartInstance.data.datasets[0].backgroundColor = percentage < 80 ? ['#f59e0b', '#cbd5e1'] : ['#10b981', '#cbd5e1'];
            scoreChartInstance.update();
        }

        function switchTab(tabId) {
            // 1. Style Tabs
            ['single', 'meteo', 'stat', 'predict'].forEach(id => {
                const btn = document.getElementById(`tab-${id}`);
                if (id === tabId) {
                    btn.classList.replace('tab-inactive', 'tab-active');
                    btn.classList.replace('text-slate-600', 'text-blue-600');
                } else {
                    btn.classList.replace('tab-active', 'tab-inactive');
                    btn.classList.remove('text-blue-600');
                }
            });

            // 2. Render Cards
            const container = document.getElementById('rules-container');
            container.innerHTML = ''; // Clear
            
            const data = ruleData[tabId];
            data.forEach(item => {
                const card = document.createElement('div');
                card.className = `bg-white rounded-lg p-6 border ${item.highlight ? 'border-l-4 border-l-blue-500 border-slate-100' : 'border-slate-100'} shadow-sm hover:shadow-md transition-shadow`;
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h4 class="text-lg font-bold text-slate-800">${item.title}</h4>
                        ${item.highlight ? '<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">é‡ç‚¹</span>' : ''}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div class="bg-slate-50 p-3 rounded">
                            <span class="block text-slate-500 text-xs mb-1">æœ‰æ•ˆèŒƒå›´</span>
                            <span class="font-mono text-slate-700 font-semibold">${item.range}</span>
                        </div>
                        <div class="bg-slate-50 p-3 rounded">
                            <span class="block text-rose-500 text-xs mb-1">æ­»æ•°/å¼‚å¸¸åˆ¤å®š</span>
                            <span class="text-slate-700">${item.deadRule}</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-slate-100">
                        <span class="text-xs font-bold text-slate-500 uppercase tracking-wide">å…³è”ä¸€è‡´æ€§æ ¡éªŒ</span>
                        <p class="text-slate-600 text-sm mt-1">${item.consistency}</p>
                    </div>
                `;
                container.appendChild(card);
            });

            // 3. Render Tool
            document.getElementById('tool-panel').innerHTML = toolsHTML[tabId];
        }

        // --- CALCULATOR TOOLS ---

        function checkRadiation() {
            const total = parseFloat(document.getElementById('rad-total').value);
            const direct = parseFloat(document.getElementById('rad-direct').value);
            const scatter = parseFloat(document.getElementById('rad-scatter').value);
            const resBox = document.getElementById('res-rad');

            if (isNaN(total) || isNaN(direct) || isNaN(scatter)) {
                resBox.classList.remove('hidden');
                resBox.innerHTML = "<span class='text-amber-400'>è¯·è¾“å…¥å®Œæ•´æ•°å€¼</span>";
                return;
            }

            const sum = direct + scatter;
            // Rule: If total < 50, denom = 50. Else denom = total.
            const denom = total < 50 ? 50 : total;
            const diff = Math.abs((sum - total) / denom);
            const percent = (diff * 100).toFixed(2);

            resBox.classList.remove('hidden');
            if (diff <= 0.05) {
                resBox.innerHTML = `<span class="text-emerald-400 font-bold">âœ… æ ¡éªŒé€šè¿‡</span><br>åå·®ç‡: ${percent}% (â‰¤5%)`;
            } else {
                resBox.innerHTML = `<span class="text-rose-400 font-bold">âŒ æ ¡éªŒå¤±è´¥</span><br>åå·®ç‡: ${percent}% (>5%)<br>è®¡ç®—å’Œ: ${sum} vs æ€»è¾å°„: ${total}`;
            }
        }

        function checkPower() {
            const cap = parseFloat(document.getElementById('calc-cap').value);
            const power = parseFloat(document.getElementById('calc-power').value);
            const resBox = document.getElementById('res-power');

            if (isNaN(cap) || isNaN(power)) {
                resBox.classList.remove('hidden');
                resBox.innerText = "è¯·è¾“å…¥æ•°å€¼";
                return;
            }

            const max = cap; // Technically usually strictly regulated, user input implies Rated
            const min = -0.1 * cap;

            resBox.classList.remove('hidden');
            if (power >= min && power <= max) {
                 resBox.innerHTML = `<span class="text-emerald-400 font-bold">âœ… åœ¨èŒƒå›´å†…</span><br>[${min}, ${max}]`;
            } else {
                 resBox.innerHTML = `<span class="text-rose-400 font-bold">âŒ è¶Šé™</span><br>å½“å‰å€¼ ${power} è¶…å‡º [${min}, ${max}]`;
            }
        }
        
        function checkStat() {
            const total = parseFloat(document.getElementById('stat-total').value);
            const sum = parseFloat(document.getElementById('stat-sum').value);
            const resBox = document.getElementById('res-stat');
            
            if (isNaN(total) || isNaN(sum)) return;
            
            // Assuming total is base, difference percentage
            const diff = Math.abs(total - sum);
            const ratio = (diff / total) * 100;
            
            resBox.classList.remove('hidden');
            if (ratio <= 10) {
                resBox.innerHTML = `<span class="text-emerald-400 font-bold">âœ… åŒ¹é…è‰¯å¥½</span><br>è¯¯å·®: ${ratio.toFixed(2)}%`;
            } else {
                resBox.innerHTML = `<span class="text-rose-400 font-bold">âŒ åå·®è¿‡å¤§</span><br>è¯¯å·®: ${ratio.toFixed(2)}% (>10%)`;
            }
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- INIT ---
        window.addEventListener('DOMContentLoaded', () => {
            initCharts();
            switchTab('single'); // Default load
        });

    </script>
</body>
</html>