# Role: 两个细则数据分析专家

## Task: “两个细则”并网管理自动化统计与多维分析

### 1. 任务目标

对两个细则数据进行清洗、录入、分析、生成日报。
请针对提供的四个核心 CSV 文件进行深度自动化分析，识别各场站的损益情况、考核重灾区、申诉减免成效以及运行质量瓶颈，并输出可视化图表和决策建议。
形成多维度数据统计，包括月度、年度、场站横比、类别横比等。

### 2. 数据源定义

/Users/yangjie/code/antigravity/两个细则分析系统/docs/两个细则管理统计表.xlsx

- **文件 A：`数据表（两个细则系统）.csv`**
  - 用途：分析考核电量（MWh）的原始分布及“免考前/后”电量差值。
  - 核心字段：厂站、免考情况、功率预测总考核电量、一次调频总考核电量等。
- **文件 B：`公示-表一、结算汇总表.csv`**
  - 用途：财务结算分析，计算最终经营损益。
  - 核心字段：电厂名称、“两个细则”结算净收入、考核费用、补偿费用。
- **文件 C：`公示-表二、并网运行考核汇总表.csv`**
  - 用途：考核项细分金额分析。
  - 核心字段：电厂名称、风电(光伏)功率预测、技术指导与管理、考核费用合计。
- **文件 D：`公示-表四、辅助服务补偿汇总表.csv`**
  - 用途：补偿项目来源分析。
  - 核心字段：电厂名称、无功补偿、AVC补偿。

### 3. 分析逻辑与步骤（请使用 Python 执行）

#### 第一阶段：数据预处理

1. **清洗数值**：统一将金额和电量字段中的 `\`、`,`、`-` 替换为 `0` 并转换为浮点数。
2. **名称对齐**：确保四个文件中的场站名称（如“樟木”、“樟木风电场”）能够正确关联。
3. **多维聚合**：按“场站”和“月份”进行汇总。

#### 第二阶段：核心维度分析

1. **经营损益分析**：
   - 计算各场站的“结算净收入”总额并排名。
   - 识别亏损最高的 Top 3 场站及盈利（或亏损最少）的场站。
2. **考核动因分析**：
   - 统计全站各项考核（功率预测、技术指导、数据合格率等）的总金额占比。
   - 针对异常值（如技术指导考核畸高的场站）进行标注。
3. **申诉效果评估**：
   - 专门计算“功率预测”在“免考前”与“免考后”的电量差值。
   - 计算各场站通过申诉挽回的预估金额（利用 考核费用/考核电量 估算单价）。
4. **运行质量对标**：
   - 对比同类型场站（风/光）的考核强度。

### 4. 技术要求

1. 通过web输入、输出和展示数据
2. 考虑后续并入：/Users/yangjie/code/antigravity/services/data parser

### 5. 输出要求

1. **数据摘要**：输出Excel汇总表格、pdf报告、重要指标。
2. **可视化图表**：
   - 场站净收入对比图（柱状图）。
   - 考核项构成分布图（饼图或堆叠柱状图）。
3. **决策建议**：根据分析结果，指出哪些场站需要重点整改，哪些考核项具备通过技术手段提升的空间。

### 6. 注意事项

- 优先处理 `数据表（两个细则系统）` 中的多级表头（Multi-index）结构。
